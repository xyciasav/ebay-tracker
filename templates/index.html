{% extends "base.html" %}
{% block title %}Inventory — eBay Tracker{% endblock %}

{% block content %}
<div style="display:flex; gap:10px; flex-wrap:wrap;">
  <a class="btn secondary" href="{{ url_for('item_new') }}">+ New Item</a>
  <a class="btn secondary" href="{{ url_for('scanner_tool') }}">Scanner / Comps Tool</a>
  <a class="btn secondary" href="{{ url_for('export_items_csv') }}">Download CSV</a>
  <a class="btn secondary" href="{{ url_for('import_ebay_active') }}">Upload eBay Listings</a>
</div>

<div class="card">
  <form method="get" class="row" style="align-items:end;">
    <div>
      <label>Search</label>
      <input name="q" value="{{ q }}" placeholder="name, notes, category...">
    </div>
    <div>
      <label>Sold</label>
      <select name="sold">
        <option value="" {% if sold_filter=="" %}selected{% endif %}>All</option>
        <option value="N" {% if sold_filter=="N" %}selected{% endif %}>N</option>
        <option value="Y" {% if sold_filter=="Y" %}selected{% endif %}>Y</option>
      </select>
    </div>
    <div>
      <label>Platform</label>
      <select name="platform">
        <option value="">All</option>
        {% for p in platforms %}
          <option value="{{ p }}" {% if platform_filter==p %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>Category</label>
      <select name="category">
        <option value="">All</option>
        {% for c in categories %}
          <option value="{{ c }}" {% if category_filter==c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>
    <div style="display:flex; gap:10px;">
      <button class="btn" type="submit">Filter</button>
      <a class="btn secondary" href="{{ url_for('index') }}">Reset</a>
    </div>
  </form>
</div>

<div class="card" style="margin-top:14px;">
<table class="table">
  <thead>
    <tr>
      <th>SKU</th>
      <th>Item</th>
      <th>Category</th>
      <th>Platform</th>
      <th>Source</th>
      <th>COG</th>
      <th>Sold</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    {% for item in items %}
      <tr>
        <td>{{ item.sku }}</td>

        <td>
          <a href="{{ url_for('item_detail', sku=item.sku) }}">
            {{ item.item_name }}
          </a>
        </td>

        <td>{{ item.category or '' }}</td>
        <td>{{ item.platform or '' }}</td>

        <!-- ✅ NEW COLUMN (must be inside the loop) -->
        <td>{{ item.source_location or '' }}</td>

        <td>
          {% if item.cog is not none %}
            ${{ '%.2f'|format(item.cog) }}
          {% endif %}
        </td>

        <td>
          {% if item.sold %}
            <span class="pill">Sold</span>
          {% else %}
            <span class="pill secondary">Unsold</span>
          {% endif %}
        </td>

        <td>
          <a class="btn secondary" href="{{ url_for('item_edit', sku=item.sku) }}">Edit</a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
