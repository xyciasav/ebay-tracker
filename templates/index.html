{% extends "base.html" %}
{% block title %}Inventory — eBay Tracker{% endblock %}

{% block content %}
<div class="card">
  <form method="get" class="row" style="align-items:end;">
    <div>
      <label>Search</label>
      <input name="q" value="{{ q }}" placeholder="name, notes, category...">
    </div>
    <div>
      <label>Sold</label>
      <select name="sold">
        <option value="" {% if sold_filter=="" %}selected{% endif %}>All</option>
        <option value="N" {% if sold_filter=="N" %}selected{% endif %}>N</option>
        <option value="Y" {% if sold_filter=="Y" %}selected{% endif %}>Y</option>
      </select>
    </div>
    <div>
      <label>Platform</label>
      <select name="platform">
        <option value="">All</option>
        {% for p in platforms %}
          <option value="{{ p }}" {% if platform_filter==p %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>Category</label>
      <select name="category">
        <option value="">All</option>
        {% for c in categories %}
          <option value="{{ c }}" {% if category_filter==c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>
    <div style="display:flex; gap:10px;">
      <button class="btn" type="submit">Filter</button>
      <a class="btn secondary" href="{{ url_for('index') }}">Reset</a>
    </div>
  </form>
</div>

<div class="card" style="margin-top:14px;">
  <table>
    <thead>
      <tr>
        <th>SKU</th>
        <th>Item Name</th>
        <th>Category</th>
        <th>Sub-Category</th>
        <th>Platform</th>
        <th>Notes</th>
        <th class="right">COG</th>
        <th class="right">Sale Price</th>
        <th class="right">Ad Fee</th>
        <th class="right">eBay Fee</th>
        <th class="right">Shipping</th>
        <th class="right">Buyer Paid</th>
        <th class="right">Net Cost</th>
        <th class="right">Gross Profit</th>
        <th>Date Listed</th>
        <th>Date Sold</th>
        <th>Sold</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td><a href="{{ url_for('item_detail', sku=it.sku) }}">{{ it.sku }}</a></td>
        <td>
          <a href="{{ url_for('item_detail', sku=it.sku) }}"><strong>{{ it.item_name }}</strong></a>
          {% if it.images|length > 0 %}
            <div class="small">{{ it.images|length }} photo(s)</div>
          {% endif %}
        </td>
        <td>{{ it.category or "" }}</td>
        <td>{{ it.sub_category or "" }}</td>
        <td>{{ it.platform or "" }}</td>
        <td class="small">{{ it.notes or "" }}</td>
        <td class="right">{{ "%.2f"|format(it.cog or 0) }}</td>
        <td class="right">{{ "%.2f"|format(it.sale_price or 0) }}</td>
        <td class="right">{{ "%.2f"|format(it.ad_fee or 0) }}</td>
        <td class="right">{{ "%.2f"|format(it.ebay_fee or 0) }}</td>
        <td class="right">{{ "%.2f"|format(it.shipping or 0) }}</td>
        <td class="right">{{ "%.2f"|format(it.buyer_paid_amount or 0) }}</td>
        <td class="right">{{ "%.2f"|format(it.net_cost) }}</td>
        <td class="right"><strong>{{ "%.2f"|format(it.gross_profit) }}</strong></td>
        <td>{{ item.source_location or '' }}</td>
        <td>{{ it.date_listed or "" }}</td>
        <td>{{ it.date_sold or "" }}</td>
        <td>
          {% if it.sold %}
            <span class="pill">Y</span>
          {% else %}
            <span class="pill">N</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
      {% if items|length == 0 %}
        <tr><td colspan="17" class="small">No items yet. Click “+ New Item”.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}
